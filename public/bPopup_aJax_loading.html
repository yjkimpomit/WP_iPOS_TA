<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>bPopup + AJAX + Loading</title>
	<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script> 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-bpopup/0.11.0/jquery.bpopup.min.js"></script>

	<style>
		#popup {
			display: none;
			width: 400px;
			padding: 20px;
			background: #fff;
			border: 1px solid #ccc;
			text-align: center;
		}
		#loading {
			display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
			font-size: 14px;
			color: red;
		}
		.pop-body {
			min-height: 100px;
			border-top: 1px solid #ddd;
			margin-top: 10px;
			padding: 10px;
		}
	</style>
</head>
<body>

<button id="openPopup">íŒì—… ì—´ê¸°</button>

<div id="popup">
	<h3>AJAX ë°ì´í„° ë¡œë“œ</h3>
	<div id="loading">ğŸ”„ ë°ì´í„° ë¡œë”© ì¤‘...</div>  <!-- ë¡œë”© í‘œì‹œ -->
	<div class="pop-body">
		<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
	</div>
	<button id="closePopup">ë‹«ê¸°</button>
</div>

<script>
	$(document).ready(function () {
		$("#openPopup").on("click", function () {
			$("#popup").bPopup({
				onOpen: function () {
					console.log("íŒì—…ì´ ì—´ë¦¼!");
					$("#loading").show();  // âœ… ë¡œë”© í‘œì‹œ í™œì„±í™”
					$(".pop-body").html("<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>");
					loadPopupData(); // AJAX ë°ì´í„° ë¡œë“œ
				},
				onClose: function () {
					console.log("íŒì—…ì´ ë‹«í˜!");
					$("#loading").hide(); // âœ… ë¡œë”© ìˆ¨ê¹€
					$(".pop-body").html("<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>"); // ì´ˆê¸°í™”
				}
			});
		});

		$("#closePopup").on("click", function () {
			$("#popup").bPopup().close();
		});

		// âœ… AJAXë¥¼ ì´ìš©í•œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
		function loadPopupData() {
			$.ajax({
				url: "data.json",  // âœ… JSON ë˜ëŠ” API URL
				type: "GET",
				dataType: "json",
				success: function (data) {
					let content = "<ul>";
					$.each(data, function (index, item) {
						content += `<li>${item.name} - ${item.value}</li>`;
					});
					content += "</ul>";

					$(".pop-body").html(content);
				},
				error: function () {
					$(".pop-body").html("<p>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>");
				},
				complete: function () {
					$("#loading").hide();  // âœ… AJAX ì™„ë£Œ í›„ ë¡œë”© ìˆ¨ê¹€
				}
			});
		}
	});
</script>

</body>
</html>
