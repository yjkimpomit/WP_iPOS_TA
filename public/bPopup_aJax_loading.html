<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>bPopup + AJAX + Loading</title>
	<script src="https://code.jquery.com/jquery-3.6.1.min.js"></script> 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-bpopup/0.11.0/jquery.bpopup.min.js"></script>

	<style>
		#popup {
			display: none;
			width: 400px;
			padding: 20px;
			background: #fff;
			border: 1px solid #ccc;
			text-align: center;
		}
		#loading {
			display: none; /* 기본적으로 숨김 */
			font-size: 14px;
			color: red;
		}
		.pop-body {
			min-height: 100px;
			border-top: 1px solid #ddd;
			margin-top: 10px;
			padding: 10px;
		}
	</style>
</head>
<body>

<button id="openPopup">팝업 열기</button>

<div id="popup">
	<h3>AJAX 데이터 로드</h3>
	<div id="loading">🔄 데이터 로딩 중...</div>  <!-- 로딩 표시 -->
	<div class="pop-body">
		<p>데이터를 불러오는 중...</p>
	</div>
	<button id="closePopup">닫기</button>
</div>

<script>
	$(document).ready(function () {
		$("#openPopup").on("click", function () {
			$("#popup").bPopup({
				onOpen: function () {
					console.log("팝업이 열림!");
					$("#loading").show();  // ✅ 로딩 표시 활성화
					$(".pop-body").html("<p>데이터를 불러오는 중...</p>");
					loadPopupData(); // AJAX 데이터 로드
				},
				onClose: function () {
					console.log("팝업이 닫힘!");
					$("#loading").hide(); // ✅ 로딩 숨김
					$(".pop-body").html("<p>데이터를 불러오는 중...</p>"); // 초기화
				}
			});
		});

		$("#closePopup").on("click", function () {
			$("#popup").bPopup().close();
		});

		// ✅ AJAX를 이용한 데이터 불러오기
		function loadPopupData() {
			$.ajax({
				url: "data.json",  // ✅ JSON 또는 API URL
				type: "GET",
				dataType: "json",
				success: function (data) {
					let content = "<ul>";
					$.each(data, function (index, item) {
						content += `<li>${item.name} - ${item.value}</li>`;
					});
					content += "</ul>";

					$(".pop-body").html(content);
				},
				error: function () {
					$(".pop-body").html("<p>데이터를 불러오는 데 실패했습니다.</p>");
				},
				complete: function () {
					$("#loading").hide();  // ✅ AJAX 완료 후 로딩 숨김
				}
			});
		}
	});
</script>

</body>
</html>
